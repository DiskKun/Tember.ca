<html>
	<head>
		<style>
body {
	background-color:#111111;
	font-family: courier;
	color: #FFFFFF;
}
				#content {
					white-space:pre;
				}
				span {
					display: inline-block;
				}
		</style>
	</head>
	<body>
		<p id="content"><span id="cursor">|</span></p>
		<script>
			var cursor = true;
			var speed = 250;
			var chars = ["\r", ">", " "];
			var content = document.getElementById('content');
			var validChars = " qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM`1234567890-=~!@#$%^&*()_+[]\\{}|;':,./<>?".split('');
			var command = "";
			var writing = false;
			var message = "";

			var unlocked = [false, false, false, false];

			updateContent();

			setInterval(() => {
				if(cursor) {
					document.getElementById('cursor').style.opacity = 0;
					cursor = false;
				}else {
					document.getElementById('cursor').style.opacity = 1;
					cursor = true;
				}

			}, speed);

			setInterval(() => {
				if (writing) {
					s = message.split('');
					chars.push(s.shift());
					message = s.join('');
					updateContent();
					document.getElementById('cursor').style.opacity = 0;
					if (message.length === 0) {
						writing = false;
					}
				}
			}, 25);

			document.addEventListener('keydown', function(event) {
				if (!writing) {

					if (validChars.includes(event.key)) {
						chars.push(event.key);
						command += event.key;
						updateContent();
						console.log(chars);
					} else if (event.key == "Enter") {
						if (command != "") {
							runCommand();
							command = "";
						}
					} else if (event.key == "Backspace") {
						if (chars.join('').slice(-3) != "\r> ") {

							command = command.substring(0, command.length - 1);
							chars.pop();
							updateContent();
						}
					}
				}
			});

			function runCommand() {
				command = command.toLowerCase();
				if (command == "help") {
					if (unlocked[0]) {
						message += "corruption: View your NexusCorp email.\r";
					} else {
                        message += "[ACCESS DENIED]: View your NexusCorp email.\r";
					}
					if (unlocked[1]) {
						message += "homestead: Access to NexusCorp image archive.\r";
                    } else {
                        message += "[ACCESS DENIED]: Access to NexusCorp image archive.\r";
                    }
					if (unlocked[2]) {
						message += "aurora: Access to employee of the month page for NexusCorp.\r";
                    } else {
                        message += "[ACCESS DENIED]: Access to employee of the month page for NexusCorp.\r";
                    }
					if (unlocked[3]) {
						message += "gate: [description goes here]\r";
                    } else {
                        message += "[ACCESS DENIED]: [description goes here]\r";
                    }
				} else if (command == "corruption") {
					window.open("./Nexus_Corporation_-_Chapter_1.html", '_blank').focus();
					unlocked[0] = true;
				} else if (command == "homestead") {
                    window.open("./Test_001.html", '_blank').focus();
					unlocked[1] = true;
				} else if (command == "aurora") {
                    window.open("https://employeesofthemonth.w3spaces.com/index.html", '_blank').focus();
					unlocked[2] = true;
				} else if (command == "gate") {
                    message = "[link to next puzzle]";
					unlocked[3] = true;
				} else {
					message = "Unrecognized command. Type \"help\" for a list of commands.";
				}
				//chars.push("\r", message, "\r> ");
				message = "\r" + message + "\r> ";
				writing = true;
			}

			function updateContent() {
				var text = "";
				for (let i = 0; i < chars.length; i++) {
					text += (chars[i]);
				}
				content.innerHTML = text + "<span id=\"cursor\">|</span>";
			}
		</script>

	</body>
</html>
